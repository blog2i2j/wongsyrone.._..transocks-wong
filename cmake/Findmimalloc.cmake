include(MacroPushRequiredVars)
MACRO_PUSH_REQUIRED_VARS(CMAKE_FIND_LIBRARY_SUFFIXES)

FIND_PATH(MIMALLOC_INCLUDE_DIR mimalloc.h)

IF(MIMALLOC_USE_STATIC_LIB)
    SET(CMAKE_FIND_LIBRARY_SUFFIXES ".a")
ENDIF()

FIND_LIBRARY(MIMALLOC_LIBRARIES NAMES mimalloc)

IF(MIMALLOC_INCLUDE_DIR)
    SET(MIMALLOC_FOUND_INCLUDE TRUE)
ENDIF(MIMALLOC_INCLUDE_DIR)
IF(MIMALLOC_LIBRARIES)
    SET(MIMALLOC_FOUND_LIBRARY TRUE)
ENDIF(MIMALLOC_LIBRARIES)
IF(MIMALLOC_FOUND_INCLUDE AND MIMALLOC_FOUND_LIBRARY)
    SET(MIMALLOC_FOUND TRUE)
ENDIF(MIMALLOC_FOUND_INCLUDE AND MIMALLOC_FOUND_LIBRARY)

IF(MIMALLOC_FOUND_INCLUDE)
    IF (NOT MIMALLOC_FIND_QUIETLY)
        MESSAGE(STATUS "Found mimalloc includes:	${MIMALLOC_INCLUDE_DIR}/mimalloc.h")
    ENDIF (NOT MIMALLOC_FIND_QUIETLY)
ELSE(MIMALLOC_FOUND_INCLUDE)
    IF (MIMALLOC_FIND_REQUIRED)
        MESSAGE(FATAL_ERROR "Could NOT find mimalloc include headers")
    ENDIF (MIMALLOC_FIND_REQUIRED)
ENDIF(MIMALLOC_FOUND_INCLUDE)

IF(MIMALLOC_FOUND_LIBRARY)
    IF (NOT MIMALLOC_FIND_QUIETLY)
        MESSAGE(STATUS "Found mimalloc library: ${MIMALLOC_LIBRARIES}")
    ENDIF (NOT MIMALLOC_FIND_QUIETLY)
ELSE(MIMALLOC_FOUND_LIBRARY)
    IF (MIMALLOC_FIND_REQUIRED)
        MESSAGE(FATAL_ERROR "Could NOT find mimalloc library")
    ENDIF (MIMALLOC_FIND_REQUIRED)
ENDIF(MIMALLOC_FOUND_LIBRARY)

MACRO_POP_REQUIRED_VARS(CMAKE_FIND_LIBRARY_SUFFIXES)
